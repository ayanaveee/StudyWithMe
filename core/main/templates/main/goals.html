{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block content %}

<section class="page-section py-5" id="goals" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh;">
  <div class="container px-4 px-lg-5">
    <h2 class="text-center text-uppercase text-white mb-5 fw-bold" style="letter-spacing: 0.15em;">Цели на неделю</h2>

    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card mb-5 shadow-lg rounded-4 border-0">
          <div class="card-body bg-white p-4 p-md-5">
            <form method="post" class="row g-4" novalidate>
              {% csrf_token %}

              <div class="col-12">
                {{ form.title.label_tag }}
                {{ form.title|add_class:"form-control form-control-lg shadow-sm" }}
                {% if form.title.errors %}
                  <div class="text-danger small mt-1">{{ form.title.errors|striptags }}</div>
                {% endif %}
              </div>

              <div class="col-md-6">
                {{ form.category.label_tag }}
                {{ form.category|add_class:"form-select form-select-lg shadow-sm" }}
                {% if form.category.errors %}
                  <div class="text-danger small mt-1">{{ form.category.errors|striptags }}</div>
                {% endif %}
              </div>

              <div class="col-md-6">
                {{ form.deadline.label_tag }}
                {{ form.deadline|add_class:"form-control form-control-lg shadow-sm" }}
                {% if form.deadline.errors %}
                  <div class="text-danger small mt-1">{{ form.deadline.errors|striptags }}</div>
                {% endif %}
              </div>

              <div class="col-md-6">
                {{ form.priority.label_tag }}
                {{ form.priority|add_class:"form-select form-select-lg shadow-sm" }}
                {% if form.priority.errors %}
                  <div class="text-danger small mt-1">{{ form.priority.errors|striptags }}</div>
                {% endif %}
              </div>

              <div class="col-12 text-end">
                <button type="submit" class="btn btn-gradient btn-lg px-4 fw-semibold shadow-sm" style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); color: white; border:none; border-radius: 0.5rem;">
                  Добавить цель
                </button>
              </div>
            </form>
          </div>
        </div>

        {% if goals %}
        <div class="list-group">
          {% for goal in goals %}
            <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center flex-wrap shadow rounded-4 mb-3" style="background: rgba(255 255 255 / 0.9); border-left: 5px solid
              {% if goal.priority == 'high' %}#dc3545
              {% elif goal.priority == 'medium' %}#ffc107
              {% else %}#6c757d{% endif %};">
              <div class="flex-grow-1 me-3">
                <h5 class="mb-1 fw-semibold text-dark">{{ goal.title }}</h5>
                <small class="text-muted">До: {{ goal.deadline|date:"d.m.Y H:i" }}</small><br>
                <small class="fw-semibold">
                  Приоритет:
                  {% if goal.priority == 'high' %}
                    <span class="badge bg-danger">Высокий</span>
                  {% elif goal.priority == 'medium' %}
                    <span class="badge bg-warning text-dark">Средний</span>
                  {% else %}
                    <span class="badge bg-secondary">Низкий</span>
                  {% endif %}
                </small>
              </div>
              <div>
                <a href="{% url 'edit_goal' goal.pk %}" class="btn btn-outline-primary btn-sm rounded-circle shadow-sm" title="Редактировать цель" style="width: 38px; height: 38px; display: flex; align-items: center; justify-content: center;">
                  <i class="fas fa-pen"></i>
                </a>
              </div>
            </div>
          {% endfor %}
        </div>
        {% else %}
          <p class="text-center text-white fst-italic fs-5 mt-4">Целей пока нет. Добавьте первую цель!</p>
        {% endif %}

      </div>
    </div>
  </div>
</section>

{% endblock %}
